clear
vocab
' vocab disasm


: ?DUP DUP IF DUP THEN ;
: ?DROP DUP IF DROP THEN ;
: ?NIP DUP IF NIP THEN ;
: ?LEAVE IF R> DROP LEAVE THEN ;

: KEY? KEY DUP ISSPACE ?NIP ;






: APPEND ( char addr -- )
    TUCK COUNT + ! ++
;
: READ ( addr n -- )
  OVER 0 SWAP !
  DUP 0 <=
  IF DROP DROP EXIT THEN
  BEGIN KEY? 0= UNTIL
  2 PICK APPEND
  1 DO
    KEY? ?LEAVE
    OVER APPEND
  LOOP DROP
;
: FIND ( addr -- addr 0 | xt 1 | xt -1 )
  LAST BEGIN DUP 0<> WHILE
    DUP NAME 2 PICK COUNT STREQ
    IF NIP DUP CODE SWAP FLAGS IMM? IF 1 ELSE -1 THEN EXIT THEN
  PREV REPEAT
;

HERE 256 ALLOT
CONSTANT TIB

: WORD TIB 31 READ TIB ;


: ' WORD FIND 0= IF DROP 0 THEN ;
: ['] ' POSTPONE LITERAL ; IMMEDIATE
: POSTPONE
  WORD FIND
  DUP  0 = IF DROP DROP EXIT THEN
  DUP  1 = IF DROP POSTPONE [POSTPONEI] COMPILE, EXIT THEN
  DUP -1 = IF DROP POSTPONE [POSTPONE] COMPILE, EXIT THEN
  DROP DROP
; IMMEDIATE
(
: POSTPONE
  WORD FIND
  DUP  0 = IF DROP DROP EXIT THEN
  DUP  1 = IF DROP COMPILE, EXIT THEN
  DUP -1 = IF DROP POSTPONE LITERAL POSTPONE COMPILE, EXIT THEN
  DROP DROP
; IMMEDIATE
)

(
: ?? POSTPONE DUP
     POSTPONE IF
     POSTPONE ['] POSTPONE EXECUTE
     POSTPONE THEN
; IMMEDIATE
)





























\ clear

